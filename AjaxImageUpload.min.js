(function(b){b.fn.ajaxFileUpload=function(f){var a=b.extend({debug:!1,uploadAction:"",uid:"",uploadTemplate:'<div class="qq-uploader"><div class="qq-upload-drop-area"><span>Drop files here to upload</span></div><div class="qq-upload-button">Upload a file</div><ul class="qq-upload-list"></ul></div>',fileTemplate:'<li><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">Cancel</a><span class="qq-upload-failed-text">Failed</span></li>',
deleteTemplate:'<div class="delete-button">Delete image</div>',clearTemplate:'<div class="qq-clear-button">Delete all images</div>',thumbX:"100px",thumbY:"100px",allowedExtensions:[],sizeLimit:0,messages:{typeError:"{file} has invalid extension. Only {extensions} are allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."}},
f);return this.each(function(){var g=b(this),h=g.find(".file-uploader-images");new qq.FileUploader({element:g.find(".file-uploader-buttons")[0],action:a.uploadAction,params:{uid:a.uid},template:a.uploadTemplate,fileTemplate:a.fileTemplate,allowedExtensions:a.allowedExtensions,sizeLimit:a.sizeLimit,messages:a.messages,onComplete:function(d,c,e){var j=e.fileid;if(e.success){var f=b("<div>").addClass("image-wrap").addClass("image"+j),c=b(a.deleteTemplate).click(function(){b.get(a.uploadAction,{"delete":j},
function(d){d.success&&(f.fadeOut(function(){b(this).remove()}),a.debug&&alert(JSON.stringify(d)+"\nImage "+j+" deleted."))},"json")}),c=b("<img>").attr({src:e.filename}).css({width:a.thumbX,height:a.thumbY,position:"relative"}).after(c);h.append(f.append(c));g.find(".qq-upload-list li").eq(d).hide();a.debug&&alert("ID:"+d+"\nResponse:"+JSON.stringify(e))}}});var f=b(a.clearTemplate).click(function(){b.get(a.uploadAction,{"delete":"all",uid:a.uid},function(b){b.success&&(h.empty(),g.find(".qq-upload-list li").remove(),
a.debug&&alert(JSON.stringify(deleteAnswer)+"\nAll Images deleted."))},"json")});h.find(".image-wrap .delete-button").click(function(){var d=b(this).parent(),c=d.attr("class").split(/\s+/);for(i=0;i<c.length;i++){var e=c[i].split("image")[1];b.get(a.uploadAction,{"delete":parseInt(e),uid:a.uid},function(c){c.success&&(d.fadeOut(function(){b(this).remove()}),a.debug&&alert(JSON.stringify(c)+"\nImage "+e+" deleted."))},"json")}});g.find(".qq-upload-button").after(f)})}})(jQuery);